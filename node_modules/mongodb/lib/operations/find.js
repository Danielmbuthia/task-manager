'use strict';

const OperationBase = require('./operation').OperationBase;
const Aspect = require('./operation').Aspect;
const defineAspects = require('./operation').defineAspects;
<<<<<<< HEAD
const ReadPreference = require('../core').ReadPreference;
const maxWireVersion = require('../core/utils').maxWireVersion;
const MongoError = require('../core/error').MongoError;
=======
const resolveReadPreference = require('../utils').resolveReadPreference;
>>>>>>> a443bfadc7c360f7746f21df0eaacc47f1521bf0

class FindOperation extends OperationBase {
  constructor(collection, ns, command, options) {
    super(options);

    this.ns = ns;
    this.cmd = command;
<<<<<<< HEAD
    this.readPreference = ReadPreference.resolve(collection, this.options);
=======
    this.readPreference = resolveReadPreference(collection, this.options);
>>>>>>> a443bfadc7c360f7746f21df0eaacc47f1521bf0
  }

  execute(server, callback) {
    // copied from `CommandOperationV2`, to be subclassed in the future
    this.server = server;

<<<<<<< HEAD
    if (typeof this.cmd.allowDiskUse !== 'undefined' && maxWireVersion(server) < 4) {
      callback(new MongoError('The `allowDiskUse` option is not supported on MongoDB < 3.2'));
      return;
    }

    // TOOD: use `MongoDBNamespace` through and through
    const cursorState = this.cursorState || {};
=======
    const cursorState = this.cursorState || {};

    // TOOD: use `MongoDBNamespace` through and through
>>>>>>> a443bfadc7c360f7746f21df0eaacc47f1521bf0
    server.query(this.ns.toString(), this.cmd, cursorState, this.options, callback);
  }
}

defineAspects(FindOperation, [
  Aspect.READ_OPERATION,
  Aspect.RETRYABLE,
<<<<<<< HEAD
  Aspect.EXECUTE_WITH_SELECTION
=======
  Aspect.EXECUTE_WITH_SELECTION,
  Aspect.SKIP_SESSION
>>>>>>> a443bfadc7c360f7746f21df0eaacc47f1521bf0
]);

module.exports = FindOperation;
